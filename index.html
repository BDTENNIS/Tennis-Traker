<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1e40af">
    <title>Tennis Junior Tracker</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiVGVubmlzIEp1bmlvciBUcmFja2VyIiwic2hvcnRfbmFtZSI6IlRlbm5pcyBUcmFja2VyIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMxZTQwYWYiLCJ0aGVtZV9jb2xvciI6IiMxZTQwYWYifQ==">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #1e40af;
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header .subtitle {
            color: #64748b;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            -webkit-overflow-scrolling: touch;
        }

        .tab {
            padding: 12px 24px;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 14px;
            font-weight: 600;
            color: #475569;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            color: #1e40af;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #1e40af;
            font-size: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 12px;
            color: white;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
            text-transform: uppercase;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #475569;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 14px 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            margin-top: 10px;
            transition: transform 0.2s;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: #64748b;
        }

        .btn-danger {
            background: #dc2626;
        }

        .match-list {
            margin-top: 20px;
        }

        .match-item {
            background: #f8fafc;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .match-item.win {
            border-left-color: #10b981;
        }

        .match-item.loss {
            border-left-color: #ef4444;
        }

        .match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .match-tournament {
            font-weight: 600;
            color: #1e40af;
            font-size: 16px;
        }

        .match-result {
            font-weight: bold;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 14px;
        }

        .match-result.win {
            background: #d1fae5;
            color: #065f46;
        }

        .match-result.loss {
            background: #fee2e2;
            color: #991b1b;
        }

        .match-details {
            font-size: 14px;
            color: #64748b;
            line-height: 1.6;
        }

        .match-score {
            font-weight: 600;
            color: #1e293b;
            margin-top: 5px;
        }

        .chart-container {
            margin-top: 20px;
            height: 250px;
            position: relative;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #64748b;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 5px;
        }

        .badge-primary {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: white;
            font-weight: bold;
        }

        .profile-info h3 {
            color: #1e40af;
            font-size: 20px;
            margin-bottom: 5px;
        }

        .profile-info p {
            color: #64748b;
            font-size: 14px;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .floating-add {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
            border: none;
            z-index: 100;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 25px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #1e40af;
            font-size: 22px;
        }

        .close-modal {
            font-size: 28px;
            cursor: pointer;
            color: #64748b;
            background: none;
            border: none;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .action-buttons {
                grid-template-columns: 1fr;
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 2000;
            animation: slideIn 0.3s;
            display: none;
        }

        .notification.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎾 Tennis Junior Tracker</h1>
            <p class="subtitle">Seguimiento UTR e ITF para Reclutamiento NCAA</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">📊 Panel</button>
            <button class="tab" onclick="switchTab('matches')">🏆 Partidos</button>
            <button class="tab" onclick="switchTab('stats')">📈 Estadísticas</button>
            <button class="tab" onclick="switchTab('profile')">👤 Perfil</button>
            <button class="tab" onclick="switchTab('export')">📤 Exportar</button>
        </div>

        <!-- DASHBOARD -->
        <div id="dashboard" class="tab-content active">
            <div class="card">
                <h2>Resumen General</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="utr-display">-</div>
                        <div class="stat-label">UTR Actual</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="total-matches">0</div>
                        <div class="stat-label">Total Partidos</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="win-rate">0%</div>
                        <div class="stat-label">% Victorias</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="itf-rank">-</div>
                        <div class="stat-label">Ranking ITF</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>📈 Evolución UTR</h2>
                <div class="chart-container">
                    <canvas id="utrChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h2>🏆 Resultados Recientes</h2>
                <div id="recent-matches"></div>
            </div>
        </div>

        <!-- MATCHES -->
        <div id="matches" class="tab-content">
            <div class="card">
                <h2>Historial de Partidos</h2>
                <div id="all-matches"></div>
            </div>
        </div>

        <!-- STATS -->
        <div id="stats" class="tab-content">
            <div class="card">
                <h2>Estadísticas por Superficie</h2>
                <div id="surface-stats"></div>
            </div>

            <div class="card">
                <h2>Rendimiento por Tipo de Competición</h2>
                <div id="level-stats"></div>
            </div>

            <div class="card">
                <h2>Estadísticas de Torneos</h2>
                <div id="tournament-stats"></div>
            </div>
        </div>

        <!-- PROFILE -->
        <div id="profile" class="tab-content">
            <div class="card">
                <h2>Información Personal</h2>
                <div class="profile-header">
                    <div class="profile-avatar" id="avatar-initials">JJ</div>
                    <div class="profile-info">
                        <h3 id="player-name-display">Jugador Junior</h3>
                        <p id="player-age-display">16 años</p>
                    </div>
                </div>

                <div class="form-group">
                    <label>Nombre Completo</label>
                    <input type="text" id="player-name" placeholder="Nombre Apellido">
                </div>

                <div class="form-group">
                    <label>Fecha de Nacimiento</label>
                    <input type="date" id="player-dob">
                </div>

                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="player-email" placeholder="jugador@email.com">
                </div>

                <div class="form-group">
                    <label>Club</label>
                    <input type="text" id="player-club" placeholder="Nombre del club">
                </div>

                <div class="form-group">
                    <label>Entrenador</label>
                    <input type="text" id="player-coach" placeholder="Nombre del entrenador">
                </div>

                <div class="form-group">
                    <label>Mano Dominante</label>
                    <select id="player-hand">
                        <option value="Diestro">Diestro</option>
                        <option value="Zurdo">Zurdo</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Revés</label>
                    <select id="player-backhand">
                        <option value="1 mano">A una mano</option>
                        <option value="2 manos">A dos manos</option>
                    </select>
                </div>

                <button class="btn" onclick="saveProfile()">💾 Guardar Perfil</button>
            </div>

            <div class="card">
                <h2>Objetivos NCAA</h2>
                <div class="form-group">
                    <label>UTR Objetivo</label>
                    <input type="number" step="0.1" id="target-utr" placeholder="Ej: 10.5">
                </div>

                <div class="form-group">
                    <label>Ranking ITF Objetivo</label>
                    <input type="number" id="target-itf" placeholder="Ej: 300">
                </div>

                <div class="form-group">
                    <label>Universidades Objetivo</label>
                    <textarea id="target-universities" rows="3" placeholder="Lista de universidades objetivo"></textarea>
                </div>

                <button class="btn" onclick="saveProfile()">💾 Guardar Objetivos</button>
            </div>
        </div>

        <!-- EXPORT -->
        <div id="export" class="tab-content">
            <div class="card">
                <h2>Exportar Datos</h2>
                <p style="color: #64748b; margin-bottom: 20px;">Descarga tus datos para presentarlos a un entrenador o crear un respaldo.</p>

                <div class="action-buttons">
                    <button class="btn" onclick="exportJSON()">📥 Guardar (JSON)</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('import-file').click()">📤 Restaurar</button>
                </div>
                <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importJSON(event)">

                <button class="btn" onclick="exportPDF()" style="margin-top: 10px;">📄 Generar Informe PDF</button>
                
                <button class="btn btn-danger" onclick="clearAllData()" style="margin-top: 20px;">🗑️ Borrar Todos los Datos</button>
            </div>

            <div class="card">
                <h2>Guía de Instalación</h2>
                <h3 style="color: #1e40af; margin: 15px 0 10px;">📱 iPhone (Safari)</h3>
                <ol style="color: #64748b; line-height: 1.8; padding-left: 20px;">
                    <li>Abre esta página en Safari</li>
                    <li>Toca el botón "Compartir" (cuadrado con flecha)</li>
                    <li>Selecciona "Añadir a pantalla de inicio"</li>
                    <li>Confirma tocando "Añadir"</li>
                </ol>

                <h3 style="color: #1e40af; margin: 15px 0 10px;">📱 Android (Chrome)</h3>
                <ol style="color: #64748b; line-height: 1.8; padding-left: 20px;">
                    <li>Abre esta página en Chrome</li>
                    <li>Toca los tres puntos (menú)</li>
                    <li>Selecciona "Añadir a pantalla de inicio"</li>
                    <li>Confirma tocando "Añadir"</li>
                </ol>

                <p style="color: #10b981; font-weight: 600; margin-top: 20px;">✅ ¡Los datos se guardan automáticamente en tu teléfono!</p>
            </div>
        </div>
    </div>

    <button class="floating-add" onclick="openMatchModal()">+</button>

    <!-- MODAL ADD MATCH -->
    <div id="match-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Agregar Partido</h2>
                <button class="close-modal" onclick="closeMatchModal()">×</button>
            </div>

            <form id="match-form" onsubmit="saveMatch(event)">
                <div class="form-group">
                    <label>Fecha del Partido</label>
                    <input type="date" id="match-date" required>
                </div>

                <div class="form-group">
                    <label>Tipo de Competición</label>
                    <select id="match-type" required onchange="updateFormFields()">
                        <option value="">Seleccionar...</option>
                        <option value="ITF">Torneo ITF Junior</option>
                        <option value="FMT">Federación Mexicana de Tenis (FMT)</option>
                        <option value="Academy">Partido de Academia</option>
                        <option value="UTR">Evento UTR Pro</option>
                        <option value="National">Campeonato Nacional</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Torneo / Evento</label>
                    <input type="text" id="match-tournament" placeholder="Nombre del torneo" required>
                </div>

                <div class="form-group" id="grade-field" style="display: none;">
                    <label>Grado ITF</label>
                    <select id="match-grade">
                        <option value="">Seleccionar...</option>
                        <option value="Grade A">Grado A</option>
                        <option value="Grade 1">Grado 1</option>
                        <option value="Grade 2">Grado 2</option>
                        <option value="Grade 3">Grado 3</option>
                        <option value="Grade 4">Grado 4</option>
                        <option value="Grade 5">Grado 5</option>
                    </select>
                </div>

                <div class="form-group" id="fmt-field" style="display: none;">
                    <label>Tipo de Torneo FMT</label>
                    <select id="match-fmt-type">
                        <option value="">Seleccionar...</option>
                        <option value="FMT National">FMT Nacional (sin puntos ITF)</option>
                        <option value="FMT-ITF">FMT sancionado ITF (con puntos ITF)</option>
                    </select>
                    <p style="font-size: 12px; color: #64748b; margin-top: 5px;">
                        ℹ️ Verifica en itftennis.com si tu torneo FMT está sancionado por ITF
                    </p>
                </div>

                <div class="form-group">
                    <label>Superficie</label>
                    <select id="match-surface" required>
                        <option value="Dura">Dura</option>
                        <option value="Arcilla">Arcilla</option>
                        <option value="Césped">Césped</option>
                        <option value="Indoor">Indoor</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Ronda</label>
                    <select id="match-round" required>
                        <option value="Q1">Clasificación - 1ra ronda</option>
                        <option value="Q2">Clasificación - 2da ronda</option>
                        <option value="Q3">Clasificación - 3ra ronda</option>
                        <option value="R32">Cuadro principal - R32</option>
                        <option value="R16">Cuadro principal - R16</option>
                        <option value="QF">Cuartos de final</option>
                        <option value="SF">Semifinal</option>
                        <option value="F">Final</option>
                        <option value="RR">Round Robin</option>
                        <option value="Training">Partido de entrenamiento</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Oponente</label>
                    <input type="text" id="match-opponent" placeholder="Nombre del oponente" required>
                </div>

                <div class="form-group">
                    <label>Ranking del Oponente (ITF)</label>
                    <input type="number" id="opponent-rank" placeholder="Ej: 250">
                </div>

                <div class="form-group">
                    <label>Resultado</label>
                    <select id="match-result" required>
                        <option value="Victoria">Victoria</option>
                        <option value="Derrota">Derrota</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Marcador</label>
                    <input type="text" id="match-score" placeholder="Ej: 6-4 6-3" required>
                </div>

                <div class="form-group">
                    <label>UTR después de este partido (opcional)</label>
                    <input type="number" step="0.01" id="match-utr" placeholder="Ej: 9.85">
                    <p style="font-size: 12px; color: #64748b; margin-top: 5px;">
                        ℹ️ La app no calcula el UTR automáticamente. Ingresa tu UTR oficial después de recibirlo.
                    </p>
                </div>

                <div class="form-group">
                    <label>Ranking ITF después de este partido (opcional)</label>
                    <input type="number" id="match-itf-rank" placeholder="Ej: 450">
                    <p style="font-size: 12px; color: #64748b; margin-top: 5px;">
                        ℹ️ Ingresa tu ranking ITF oficial publicado por la ITF.
                    </p>
                </div>

                <div class="form-group">
                    <label>Notas (opcional)</label>
                    <textarea id="match-notes" rows="3" placeholder="Puntos fuertes, áreas a mejorar..."></textarea>
                </div>

                <div class="form-group">
                    <label>🎯 Análisis del Oponente (opcional)</label>
                    <textarea id="opponent-analysis" rows="2" placeholder="Fortalezas/debilidades del oponente, estilo de juego..."></textarea>
                </div>

                <div class="form-group">
                    <label>📊 Análisis de Mi Rendimiento (opcional)</label>
                    <textarea id="performance-analysis" rows="3" placeholder="Lo que funcionó bien, áreas a mejorar, tácticas utilizadas..."></textarea>
                </div>

                <div class="form-group">
                    <label>🧠 Estado Mental y Físico (opcional)</label>
                    <textarea id="mental-physical" rows="2" placeholder="Nivel de energía, concentración, manejo del estrés, lesiones/dolores..."></textarea>
                </div>

                <button type="submit" class="btn">✅ Guardar Partido</button>
            </form>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // ===== ALMACENAMIENTO LOCAL =====
        const STORAGE_KEY = 'tennis_tracker_data_es';

        function loadData() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : {
                profile: {},
                matches: [],
                utrHistory: [],
                itfHistory: []
            };
        }

        function saveData(data) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            showNotification('✅ Datos guardados automáticamente');
        }

        let appData = loadData();

        // ===== NAVEGACIÓN =====
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'dashboard') updateDashboard();
            if (tabName === 'matches') displayAllMatches();
            if (tabName === 'stats') displayStats();
            if (tabName === 'profile') loadProfileData();
        }

        // ===== MODAL =====
        function openMatchModal() {
            document.getElementById('match-modal').classList.add('active');
            document.getElementById('match-date').valueAsDate = new Date();
        }

        function closeMatchModal() {
            document.getElementById('match-modal').classList.remove('active');
            document.getElementById('match-form').reset();
        }

        // ===== GUARDAR PARTIDO =====
        function saveMatch(e) {
            e.preventDefault();

            const match = {
                id: Date.now(),
                date: document.getElementById('match-date').value,
                type: document.getElementById('match-type').value,
                tournament: document.getElementById('match-tournament').value,
                grade: document.getElementById('match-grade').value,
                fmtType: document.getElementById('match-fmt-type').value,
                surface: document.getElementById('match-surface').value,
                round: document.getElementById('match-round').value,
                opponent: document.getElementById('match-opponent').value,
                opponentRank: document.getElementById('opponent-rank').value,
                result: document.getElementById('match-result').value,
                score: document.getElementById('match-score').value,
                utr: document.getElementById('match-utr').value,
                itfRank: document.getElementById('match-itf-rank').value,
                notes: document.getElementById('match-notes').value,
                opponentAnalysis: document.getElementById('opponent-analysis').value,
                performanceAnalysis: document.getElementById('performance-analysis').value,
                mentalPhysical: document.getElementById('mental-physical').value
            };

            appData.matches.push(match);

            if (match.utr) {
                appData.utrHistory.push({
                    date: match.date,
                    value: parseFloat(match.utr)
                });
            }

            if (match.itfRank) {
                appData.itfHistory.push({
                    date: match.date,
                    value: parseInt(match.itfRank)
                });
            }

            saveData(appData);
            closeMatchModal();
            updateDashboard();
            showNotification('🎾 ¡Partido guardado con éxito!');
        }

        // ===== GESTIÓN DEL FORMULARIO =====
        function updateFormFields() {
            const type = document.getElementById('match-type').value;
            const gradeField = document.getElementById('grade-field');
            const fmtField = document.getElementById('fmt-field');

            gradeField.style.display = 'none';
            fmtField.style.display = 'none';

            if (type === 'ITF') {
                gradeField.style.display = 'block';
            } else if (type === 'FMT') {
                fmtField.style.display = 'block';
            }
        }

        // ===== DASHBOARD =====
        function updateDashboard() {
            const matches = appData.matches;
            const wins = matches.filter(m => m.result === 'Victoria').length;
            const total = matches.length;
            const winRate = total > 0 ? Math.round((wins / total) * 100) : 0;

            document.getElementById('total-matches').textContent = total;
            document.getElementById('win-rate').textContent = winRate + '%';

            const latestUTR = appData.utrHistory.length > 0 
                ? appData.utrHistory[appData.utrHistory.length - 1].value 
                : '-';
            document.getElementById('utr-display').textContent = latestUTR;

            const latestITF = appData.itfHistory.length > 0 
                ? appData.itfHistory[appData.itfHistory.length - 1].value 
                : '-';
            document.getElementById('itf-rank').textContent = latestITF;

            displayRecentMatches();
            drawUTRChart();
        }

        function displayRecentMatches() {
            const container = document.getElementById('recent-matches');
            const recentMatches = appData.matches.slice(-5).reverse();

            if (recentMatches.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">🎾</div>
                        <p>No hay partidos registrados</p>
                        <p style="font-size: 14px; margin-top: 10px;">Haz clic en el botón + para agregar tu primer partido</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = recentMatches.map(match => {
                const typeLabel = getTypeLabel(match.type);
                const competitionInfo = getCompetitionInfo(match);
                
                return `
                <div class="match-item ${match.result === 'Victoria' ? 'win' : 'loss'}">
                    <div class="match-header">
                        <div class="match-tournament">${match.tournament}</div>
                        <div class="match-result ${match.result === 'Victoria' ? 'win' : 'loss'}">
                            ${match.result === 'Victoria' ? '✓' : '✗'}
                        </div>
                    </div>
                    <div class="match-details">
                        📅 ${formatDate(match.date)} • ${match.surface} • ${match.round}
                        <br>🎾 vs ${match.opponent} ${match.opponentRank ? '(#' + match.opponentRank + ')' : ''}
                        <div class="match-score">${match.score}</div>
                        <span class="badge badge-primary">${typeLabel}</span>
                        ${competitionInfo}
                        ${match.utr ? '<span class="badge badge-success">UTR: ' + match.utr + '</span>' : ''}
                    </div>
                </div>
            `}).join('');
        }

        function getTypeLabel(type) {
            const labels = {
                'ITF': 'ITF Junior',
                'FMT': 'FMT',
                'Academy': 'Academia',
                'UTR': 'UTR Pro',
                'National': 'Nacional'
            };
            return labels[type] || type;
        }

        function getCompetitionInfo(match) {
            if (match.type === 'ITF' && match.grade) {
                return '<span class="badge badge-primary">' + match.grade + '</span>';
            }
            if (match.type === 'FMT' && match.fmtType) {
                const fmtLabels = {
                    'FMT National': 'FMT Nacional ❌ ITF',
                    'FMT-ITF': 'FMT-ITF ✓ ITF'
                };
                return '<span class="badge badge-primary">' + (fmtLabels[match.fmtType] || match.fmtType) + '</span>';
            }
            return '';
        }

        function displayAllMatches() {
            const container = document.getElementById('all-matches');
            const matches = [...appData.matches].reverse();

            if (matches.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">🎾</div>
                        <p>No hay partidos registrados</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = matches.map(match => {
                const typeLabel = getTypeLabel(match.type);
                const competitionInfo = getCompetitionInfo(match);
                
                return `
                <div class="match-item ${match.result === 'Victoria' ? 'win' : 'loss'}">
                    <div class="match-header">
                        <div class="match-tournament">${match.tournament}</div>
                        <div class="match-result ${match.result === 'Victoria' ? 'win' : 'loss'}">
                            ${match.result === 'Victoria' ? 'VICTORIA' : 'DERROTA'}
                        </div>
                    </div>
                    <div class="match-details">
                        📅 ${formatDate(match.date)} • ${match.surface} • ${match.round}
                        <br>🎾 vs ${match.opponent} ${match.opponentRank ? '(ITF #' + match.opponentRank + ')' : ''}
                        <div class="match-score">Marcador: ${match.score}</div>
                        <span class="badge badge-primary">${typeLabel}</span>
                        ${competitionInfo}
                        ${match.utr ? '<span class="badge badge-success">UTR: ' + match.utr + '</span>' : ''}
                        ${match.itfRank ? '<span class="badge badge-primary">ITF: #' + match.itfRank + '</span>' : ''}
                        ${match.notes ? '<p style="margin-top: 10px; font-style: italic; color: #475569;">💭 ' + match.notes + '</p>' : ''}
                        ${match.opponentAnalysis ? '<p style="margin-top: 8px; color: #1e40af;"><strong>🎯 Oponente:</strong> ' + match.opponentAnalysis + '</p>' : ''}
                        ${match.performanceAnalysis ? '<p style="margin-top: 8px; color: #059669;"><strong>📊 Mi Rendimiento:</strong> ' + match.performanceAnalysis + '</p>' : ''}
                        ${match.mentalPhysical ? '<p style="margin-top: 8px; color: #7c3aed;"><strong>🧠 Mental/Físico:</strong> ' + match.mentalPhysical + '</p>' : ''}
                    </div>
                </div>
            `}).join('');
        }

        // ===== ESTADÍSTICAS =====
        function displayStats() {
            displaySurfaceStats();
            displayTypeStats();
            displayTournamentStats();
        }

        function displaySurfaceStats() {
            const container = document.getElementById('surface-stats');
            const surfaces = {};

            appData.matches.forEach(match => {
                if (!surfaces[match.surface]) {
                    surfaces[match.surface] = { wins: 0, losses: 0 };
                }
                if (match.result === 'Victoria') {
                    surfaces[match.surface].wins++;
                } else {
                    surfaces[match.surface].losses++;
                }
            });

            if (Object.keys(surfaces).length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No hay datos disponibles</p></div>';
                return;
            }

            container.innerHTML = Object.entries(surfaces).map(([surface, stats]) => {
                const total = stats.wins + stats.losses;
                const winRate = Math.round((stats.wins / total) * 100);
                return `
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <strong style="color: #1e40af;">${surface}</strong>
                            <span style="color: #64748b;">${stats.wins}V - ${stats.losses}D (${winRate}%)</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${winRate}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function displayTypeStats() {
            const container = document.getElementById('level-stats');
            const types = {};

            appData.matches.forEach(match => {
                const type = match.type || 'No especificado';
                if (!types[type]) {
                    types[type] = { wins: 0, losses: 0 };
                }
                if (match.result === 'Victoria') {
                    types[type].wins++;
                } else {
                    types[type].losses++;
                }
            });

            if (Object.keys(types).length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No hay datos disponibles</p></div>';
                return;
            }

            container.innerHTML = Object.entries(types).map(([type, stats]) => {
                const total = stats.wins + stats.losses;
                const winRate = Math.round((stats.wins / total) * 100);
                const typeLabel = getTypeLabel(type);
                return `
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <strong style="color: #1e40af;">${typeLabel}</strong>
                            <span style="color: #64748b;">${stats.wins}V - ${stats.losses}D (${winRate}%)</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${winRate}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function displayTournamentStats() {
            const container = document.getElementById('tournament-stats');
            const tournaments = {};

            appData.matches.forEach(match => {
                if (!tournaments[match.tournament]) {
                    tournaments[match.tournament] = {
                        matches: [],
                        wins: 0,
                        losses: 0,
                        type: match.type,
                        grade: match.grade,
                        fmtType: match.fmtType,
                        surface: match.surface
                    };
                }
                tournaments[match.tournament].matches.push(match);
                if (match.result === 'Victoria') {
                    tournaments[match.tournament].wins++;
                } else {
                    tournaments[match.tournament].losses++;
                }
            });

            if (Object.keys(tournaments).length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No hay datos disponibles</p></div>';
                return;
            }

            container.innerHTML = Object.entries(tournaments).map(([name, data]) => {
                const bestRound = data.matches.reduce((best, match) => {
                    const rounds = ['Q1', 'Q2', 'Q3', 'R32', 'R16', 'QF', 'SF', 'F', 'RR', 'Training'];
                    return rounds.indexOf(match.round) > rounds.indexOf(best) ? match.round : best;
                }, 'Q1');
                
                const typeLabel = getTypeLabel(data.type);
                let competitionDetail = typeLabel;
                if (data.grade) competitionDetail += ' - ' + data.grade;
                if (data.fmtType) {
                    const fmtLabels = {
                        'FMT National': 'FMT Nacional',
                        'FMT-ITF': 'FMT-ITF'
                    };
                    competitionDetail += ' - ' + (fmtLabels[data.fmtType] || data.fmtType);
                }
                
                return `
                    <div style="background: #f8fafc; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <strong style="color: #1e40af;">${name}</strong>
                            <span class="badge badge-primary">${competitionDetail}</span>
                        </div>
                        <div style="color: #64748b; font-size: 14px;">
                            ${data.surface} • Récord: ${data.wins}V - ${data.losses}D
                            <br>Mejor ronda: <strong>${bestRound}</strong>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ===== GRÁFICO UTR =====
        function drawUTRChart() {
            const canvas = document.getElementById('utrChart');
            const ctx = canvas.getContext('2d');
            const container = canvas.parentElement;
            
            canvas.width = container.offsetWidth;
            canvas.height = 250;

            if (appData.utrHistory.length === 0) {
                ctx.fillStyle = '#64748b';
                ctx.font = '16px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('No hay datos de UTR', canvas.width / 2, canvas.height / 2);
                return;
            }

            const padding = 40;
            const chartWidth = canvas.width - padding * 2;
            const chartHeight = canvas.height - padding * 2;

            const utrValues = appData.utrHistory.map(h => h.value);
            const minUTR = Math.min(...utrValues);
            const maxUTR = Math.max(...utrValues);
            const utrRange = maxUTR - minUTR || 1;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Cuadrícula
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(canvas.width - padding, y);
                ctx.stroke();

                const value = maxUTR - (utrRange / 5) * i;
                ctx.fillStyle = '#64748b';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'right';
                ctx.fillText(value.toFixed(1), padding - 10, y + 4);
            }

            // Línea UTR
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();

            appData.utrHistory.forEach((point, index) => {
                const x = padding + (chartWidth / (appData.utrHistory.length - 1 || 1)) * index;
                const y = padding + chartHeight - ((point.value - minUTR) / utrRange) * chartHeight;

                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();

            // Puntos
            appData.utrHistory.forEach((point, index) => {
                const x = padding + (chartWidth / (appData.utrHistory.length - 1 || 1)) * index;
                const y = padding + chartHeight - ((point.value - minUTR) / utrRange) * chartHeight;

                ctx.fillStyle = '#667eea';
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fill();

                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.stroke();
            });
        }

        // ===== PERFIL =====
        function loadProfileData() {
            const profile = appData.profile;
            
            if (profile.name) document.getElementById('player-name').value = profile.name;
            if (profile.dob) document.getElementById('player-dob').value = profile.dob;
            if (profile.email) document.getElementById('player-email').value = profile.email;
            if (profile.club) document.getElementById('player-club').value = profile.club;
            if (profile.coach) document.getElementById('player-coach').value = profile.coach;
            if (profile.hand) document.getElementById('player-hand').value = profile.hand;
            if (profile.backhand) document.getElementById('player-backhand').value = profile.backhand;
            if (profile.targetUTR) document.getElementById('target-utr').value = profile.targetUTR;
            if (profile.targetITF) document.getElementById('target-itf').value = profile.targetITF;
            if (profile.universities) document.getElementById('target-universities').value = profile.universities;

            updateProfileDisplay();
        }

        function saveProfile() {
            appData.profile = {
                name: document.getElementById('player-name').value,
                dob: document.getElementById('player-dob').value,
                email: document.getElementById('player-email').value,
                club: document.getElementById('player-club').value,
                coach: document.getElementById('player-coach').value,
                hand: document.getElementById('player-hand').value,
                backhand: document.getElementById('player-backhand').value,
                targetUTR: document.getElementById('target-utr').value,
                targetITF: document.getElementById('target-itf').value,
                universities: document.getElementById('target-universities').value
            };

            saveData(appData);
            updateProfileDisplay();
            showNotification('✅ ¡Perfil guardado!');
        }

        function updateProfileDisplay() {
            const profile = appData.profile;
            const name = profile.name || 'Jugador Junior';
            const dob = profile.dob;

            document.getElementById('player-name-display').textContent = name;
            
            if (dob) {
                const age = calculateAge(dob);
                document.getElementById('player-age-display').textContent = age + ' años';
            }

            const initials = name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
            document.getElementById('avatar-initials').textContent = initials;
        }

        function calculateAge(dob) {
            const today = new Date();
            const birthDate = new Date(dob);
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        }

        // ===== EXPORTAR/IMPORTAR =====
        function exportJSON() {
            const dataStr = JSON.stringify(appData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'tennis_tracker_backup_' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
            showNotification('📥 ¡Respaldo descargado!');
        }

        function importJSON(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    appData = imported;
                    saveData(appData);
                    updateDashboard();
                    loadProfileData();
                    showNotification('📤 ¡Datos restaurados con éxito!');
                } catch (error) {
                    showNotification('❌ Error al importar');
                }
            };
            reader.readAsText(file);
        }

        function exportPDF() {
            const profile = appData.profile;
            const matches = appData.matches;
            const wins = matches.filter(m => m.result === 'Victoria').length;
            const total = matches.length;
            const winRate = total > 0 ? Math.round((wins / total) * 100) : 0;

            const latestUTR = appData.utrHistory.length > 0 
                ? appData.utrHistory[appData.utrHistory.length - 1].value 
                : 'No especificado';
            const latestITF = appData.itfHistory.length > 0 
                ? appData.itfHistory[appData.itfHistory.length - 1].value 
                : 'No especificado';

            let pdfContent = `
INFORME DE TENIS - RECLUTAMIENTO NCAA
═══════════════════════════════════════════

PERFIL DEL JUGADOR
───────────────────────────────────────────
Nombre: ${profile.name || 'No especificado'}
Fecha de Nacimiento: ${profile.dob ? formatDate(profile.dob) : 'No especificado'}
Club: ${profile.club || 'No especificado'}
Entrenador: ${profile.coach || 'No especificado'}
Mano Dominante: ${profile.hand || 'No especificado'}
Revés: ${profile.backhand || 'No especificado'}

ESTADÍSTICAS ACTUALES
───────────────────────────────────────────
UTR Actual: ${latestUTR}
Ranking ITF: ${latestITF}
Total de Partidos: ${total}
Victorias: ${wins}
Derrotas: ${total - wins}
Porcentaje de Victorias: ${winRate}%

OBJETIVOS NCAA
───────────────────────────────────────────
UTR Objetivo: ${profile.targetUTR || 'No definido'}
Ranking ITF Objetivo: ${profile.targetITF || 'No definido'}
Universidades Objetivo: ${profile.universities || 'No definidas'}

HISTORIAL DE PARTIDOS
───────────────────────────────────────────
`;

            matches.forEach((match, index) => {
                const typeLabel = getTypeLabel(match.type);
                let competitionInfo = typeLabel;
                if (match.grade) competitionInfo += ' - ' + match.grade;
                if (match.fmtType) {
                    const fmtLabels = {
                        'FMT National': 'FMT Nacional',
                        'FMT-ITF': 'FMT-ITF'
                    };
                    competitionInfo += ' - ' + (fmtLabels[match.fmtType] || match.fmtType);
                }
                
                pdfContent += `
${index + 1}. ${match.tournament} - ${formatDate(match.date)}
   Tipo: ${competitionInfo}
   ${match.result.toUpperCase()} vs ${match.opponent} ${match.opponentRank ? '(ITF #' + match.opponentRank + ')' : ''}
   Marcador: ${match.score} | Superficie: ${match.surface} | Ronda: ${match.round}
   ${match.utr ? 'UTR después del partido: ' + match.utr : ''}
   ${match.itfRank ? 'Ranking ITF: #' + match.itfRank : ''}
   ${match.notes ? 'Notas: ' + match.notes : ''}
   ${match.opponentAnalysis ? 'Análisis del Oponente: ' + match.opponentAnalysis : ''}
   ${match.performanceAnalysis ? 'Análisis del Rendimiento: ' + match.performanceAnalysis : ''}
   ${match.mentalPhysical ? 'Estado Mental/Físico: ' + match.mentalPhysical : ''}
`;
            });

            pdfContent += `
───────────────────────────────────────────
Informe generado el ${new Date().toLocaleDateString('es-ES')}
`;

            const blob = new Blob([pdfContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'informe_tenis_' + new Date().toISOString().split('T')[0] + '.txt';
            link.click();
            showNotification('📄 ¡Informe descargado!');
        }

        function clearAllData() {
            if (confirm('⚠️ ADVERTENCIA: Todos los datos serán eliminados permanentemente. ¿Estás seguro?')) {
                if (confirm('Confirmación final: ¿eliminar TODOS los datos?')) {
                    localStorage.removeItem(STORAGE_KEY);
                    appData = { profile: {}, matches: [], utrHistory: [], itfHistory: [] };
                    updateDashboard();
                    showNotification('🗑️ Todos los datos han sido eliminados');
                }
            }
        }

        // ===== UTILIDADES =====
        function formatDate(dateStr) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateStr).toLocaleDateString('es-ES', options);
        }

        function showNotification(message) {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.classList.add('show');
            setTimeout(() => {
                notif.classList.remove('show');
            }, 3000);
        }

        // ===== INICIALIZACIÓN =====
        window.addEventListener('load', () => {
            updateDashboard();
            updateProfileDisplay();
        });

        document.getElementById('match-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeMatchModal();
            }
        });
    </script>
</body>
</html>
